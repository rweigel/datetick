# Create plots with varying time ranges.

import os
import dateutil.parser
import matplotlib.pyplot as plt

from datetick import datetick

if not os.path.exists('datetick_test'):
    os.makedirs('datetick_test', exist_ok=True)

def append_to_readme(image_links):

  with open('README.md', 'r+') as file:
    lines = file.readlines()

  index = next(i for i, line in enumerate(lines) if "Comparison to default Matplotlib" in line)
  del lines[index+1:]
  lines.append("\n" + "\n".join(image_links))
  with open('README.md', 'w') as file:
    file.writelines(lines)


image_links = []
def plot(ds1, ds2):
  dt1 = dateutil.parser.parse(ds1)
  dt2 = dateutil.parser.parse(ds2)
  x = [dt1, dt2]
  y = [0.0,0.0]
  _, axes = plt.subplots(2, figsize=(8,4) )
  axes[0].set_title(ds1 + ' - ' + ds2)
  axes[0].plot(x, y, '*')
  axes[0].text(x[0], 0.04, 'matplotlib')
  axes[0].grid()

  axes[1].plot(x, y, '*')
  axes[1].text(x[0], 0.04, 'datetick')
  datetick('x', axes=axes[1])
  axes[1].grid()

  ds1 = ds1.replace(":","").replace("-","").replace("T","").replace("Z","")
  ds2 = ds2.replace(":","").replace("-","").replace("T","").replace("Z","")
  fname = f'datetick_test/{ds1}-{ds2}.svg'
  print("Writing", fname)
  plt.savefig(fname, bbox_inches='tight')
  plt.close()
  image_links.append(f'![{fname}]({fname})')

###############################################################################
# 0.1 <= dt < 0.5 second
plot('2001-01-01T00:00:00.0Z','2001-01-01T00:00:00.2Z')
plot('2001-01-01T00:00:00.0Z','2001-01-01T00:00:00.1Z')

###############################################################################
# .5 <= dt < 1 second

plot('2001-01-01T00:00:00.0Z','2001-01-01T00:00:00.5Z')
plot('2001-01-01T00:00:00.01Z','2001-01-01T00:00:00.99Z')

# Cross minute boundary
plot('2001-01-01T00:00:59.8Z','2001-01-01T00:01:00.3Z')

# Cross hour boundary
plot('2001-01-01T00:59:59.8Z','2001-01-01T01:00:03.0Z')

# Cross day boundary
plot('2001-01-01T23:59:59.8Z','2001-01-02T00:00:03.0Z')

###############################################################################
# 1 <= dt < 5 second

plot('2001-01-01T00:00:00Z','2001-01-01T00:00:01Z')
plot('2001-01-01T00:00:00Z','2001-01-01T00:00:05Z')

# Cross minute boundary
plot('2001-01-01T00:00:59Z','2001-01-01T00:01:03Z')

# Cross hour boundary
plot('2001-01-01T00:59:58Z','2001-01-01T01:00:03Z')
plot('2001-01-01T00:59:59Z','2001-01-01T01:00:04Z')

# Cross day boundary
plot('2001-01-01T23:59:58Z','2001-01-02T00:00:03Z')

###############################################################################
# 5 <= dt < 10 second

plot('2001-01-01T00:00:00Z','2001-01-01T00:00:07Z')
plot('2001-01-01T00:00:00Z','2001-01-01T00:00:09Z')
plot('2001-01-01T00:00:01Z','2001-01-01T00:00:06Z')

# Cross day boundary
plot('2001-01-01T23:59:58Z','2001-01-02T00:00:05Z')

# Cross day boundary
# Problem: Second row of labels overlap
plot('2001-01-01T23:59:59Z','2001-01-02T00:00:05Z')

# Cross hour boundary only
plot('2001-01-01T00:59:58Z','2001-01-01T01:00:05Z')

# Cross hour boundary/max time span for this tick locator
plot('2001-01-01T00:59:58Z','2001-01-01T01:00:07Z')

# Cross hour boundary/min time span for this tick locator
plot('2001-01-01T00:59:58Z','2001-01-01T01:00:03Z')

###############################################################################
# 10 <= dt < 20 second

# Cross day boundary
plot('2001-01-01T23:59:56Z','2001-01-02T00:00:10Z')

# Cross day boundary
# Problem: Second row of labels overlap
plot('2001-01-01T23:59:58Z','2001-01-02T00:00:10Z')

# Cross hour boundary only
plot('2001-01-01T00:59:56Z','2001-01-01T01:00:10Z')

# Cross hour boundary/max time span for this tick locator
plot('2001-01-01T00:59:56Z','2001-01-01T01:00:15Z')

# Cross hour boundary/min time span for this tick locator
plot('2001-01-01T00:59:56Z','2001-01-01T01:00:06Z')

###############################################################################
# 20 <= dt < 30 second

plot('2001-01-01T00:00:00Z','2001-01-01T00:00:21Z')

###############################################################################
# 6 <= dt < 12 hours

plot('2001-01-01T00:00:00Z','2001-01-01T06:00:00Z')
plot('2001-01-01T00:00:00Z','2001-01-01T09:00:00Z')
plot('2001-01-01T00:00:00Z','2001-01-01T11:00:00Z')

# Cross hour boundary
plot('2001-01-01T00:59:58Z','2001-01-01T01:00:28Z')

# Cross minute boundary
plot('2001-01-01T00:00:58Z','2001-01-01T00:01:18Z')

###############################################################################
# 12 <= dt < 24 hours

plot('2001-01-01T00:00:00Z','2001-01-01T18:00:00Z')
plot('2001-01-01T00:00:00Z','2001-01-01T12:00:00Z')
plot('2001-01-01T00:00:00Z','2001-01-01T23:00:00Z')
plot('2001-01-01T02:00:00Z','2001-01-02T01:00:00Z')

###############################################################################
# 24 <= dt < 48 hours

plot('2001-01-01T00:00:00Z','2001-01-02T01:00:00Z')
plot('2001-01-01T00:00:00Z','2001-01-02T23:00:00Z')
plot('2001-01-01T06:00:00Z','2001-01-02T07:00:00Z')
plot('2001-01-01T00:30:00Z','2001-01-02T01:00:00Z')

###############################################################################
# 48 <= dt < 72 hours

plot('2001-01-01T00:00:00Z','2001-01-03T00:00:00Z')
plot('2001-01-01T00:00:00Z','2001-01-03T12:30:00Z')
plot('2001-01-01T00:00:00Z','2001-01-03T23:59:59Z')

###############################################################################
# 4 <= dt < 8 days

plot('2001-01-01T00:00:00Z','2001-01-05T00:00:00Z')
plot('2001-01-01T00:00:00Z','2001-01-05T00:00:00Z')
plot('2001-01-30T00:00:00Z','2001-02-01T23:00:00Z') # Span month boundary
plot('2001-12-30T00:00:00Z','2002-01-01T23:00:00Z') # Span year boundary

###############################################################################
# 8 <= dt < 16 days

plot('2001-01-01T00:00:00Z','2001-01-09T00:00:00Z')
plot('2001-01-01T00:00:00Z','2001-01-16T23:00:00Z')
plot('2001-01-30T00:00:00Z','2001-02-04T23:00:00Z') # Span month boundary
plot('2001-12-30T00:00:00Z','2002-01-04T23:00:00Z') # Span year boundary

###############################################################################
# 16 <= dt < 32 days

plot('2001-01-01T00:00:00Z','2001-01-31T00:00:00Z')
plot('2001-01-01T00:00:00Z','2001-01-16T23:00:00Z')
plot('2001-01-30T00:00:00Z','2001-02-15T23:00:00Z') # Span month boundary
plot('2001-12-30T00:00:00Z','2001-01-15T23:00:00Z') # Span year boundary

###############################################################################
# 32 <= dt < 60 days

plot('2001-01-01T00:00:00Z','2001-02-02T00:00:00Z')
plot('2001-01-01T00:00:00Z','2001-02-27T23:00:00Z')
plot('2001-01-15T00:00:00Z','2001-02-16T23:00:00Z')
plot('2001-12-31T00:00:00Z','2002-02-26T23:00:00Z') # Span year boundary

###############################################################################
# 60 <= dt < 183 days

plot('2001-01-01T00:00:00Z','2001-05-02T00:00:00Z')
plot('2001-01-01T00:00:00Z','2001-02-27T23:00:00Z')
plot('2001-12-31T00:00:00Z','2002-02-26T23:00:00Z')

###############################################################################
# 183 <= dt < 367 days

plot('2001-01-01T00:00:00Z','2001-07-02T00:00:00Z')
plot('2001-01-01T00:00:00Z','2001-12-31T00:00:00Z')
plot('2001-02-12T00:00:00Z','2002-01-31T00:00:00Z')

###############################################################################
# 367 <= dt < 366*2 days

plot('2001-01-01T00:00:00Z','2002-01-03T00:00:00Z')
plot('2001-01-01T00:00:00Z','2002-12-31T00:00:00Z')
plot('2001-04-01T00:00:00Z','2002-04-30T00:00:00Z')
plot('2001-10-01T00:00:00Z','2003-10-04T00:00:00Z')

###############################################################################
# 366*2 days <= dt < 366*8 days

plot('2001-01-01T00:00:00Z','2008-12-31T00:00:00Z')
plot('2001-01-01T00:00:00Z','2003-01-04T00:00:00Z')

###############################################################################
# 366*8 days <= dt < 366*15 days

plot('2001-01-01T00:00:00Z','2009-01-04T00:00:00Z')
plot('2001-01-01T00:00:00Z','2012-01-04T00:00:00Z')

###############################################################################
# 366*15 days <= dt < 366*40 days

plot('2000-01-01T00:00:00Z','2017-01-04T00:00:00Z')
plot('2001-01-01T00:00:00Z','2018-01-04T00:00:00Z')
plot('2002-01-01T00:00:00Z','2019-01-04T00:00:00Z')
plot('2003-01-01T00:00:00Z','2020-01-04T00:00:00Z')
plot('2004-01-01T00:00:00Z','2030-01-04T00:00:00Z')

###############################################################################
# > 50 years

plot('1950-01-01T00:00:00Z','2012-01-04T00:00:00Z')

append_to_readme(image_links)
